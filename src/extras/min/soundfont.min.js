/*!
 * timbre.soundfont.js
 * http://skratchdot.com/projects/timbre.soundfont.js/
 *
 * Copyright (c) 2013 skratchdot
 * Licensed under the MIT license.
 */
(function(){"use strict";var e,t,n={},i=5e3,s="https://free-midi.googlecode.com/git/channel/0/instrument/{instrument}/{note}.js?_callback=soundfont_0_{instrument}_{note}",r="gm",a=0,o=0,u=64,c=!0,l={};e=function(e){l.hasOwnProperty(r)||(l[r]={}),l[r].hasOwnProperty(a)||(l[r][a]={}),l[r][a].hasOwnProperty(o)||(l[r][a][o]={}),l[r][a][o].hasOwnProperty(u)||(l[r][a][o][u]={}),l[r][a][o][u].hasOwnProperty(e)||(l[r][a][o][u][e]={sample:null,isLoading:!1,loadTime:(new Date).getTime(),callbacks:[]})},t=function(t,h){var f,p;if(e(t),f=l[r][a][o][u][t],null!==f.sample)h(f,!0);else if(f.isLoading&&i>(new Date).getTime()-f.loadTime)f.callbacks.push(h);else{f.isLoading=!0;try{p=s.replace(/\{name\}/gi,r).replace(/\{channel\}/gi,a).replace(/\{instrument\}/gi,o).replace(/\{length\}/gi,u).replace(/\{note\}/gi,t),timbre("audio"+(c?".jsonp":"")).loadthis(p,function(){var e,i;for(f.sample=this,e=0;f.callbacks.length>e;e++)i=f.callbacks[e],"function"==typeof i&&i(f,!1);f.callbacks=[],f.isLoading=!1,h(f,!1),n.onLoad(f,t)},function(){throw Error('T("audio").loadthis() error.')}).on("ended",function(){f.sample.pause()})}catch(d){f.isLoading=!1,f.sample=null,f.callbacks.push(h),n.onError(d,t)}}},n.emptyCache=function(){l={}},n.setUrlTemplate=function(e){n.emptyCache(),s=e},n.setName=function(e){r=e},n.setChannel=function(e){a=e},n.setInstrument=function(e){o=e},n.setLength=function(e){u=e},n.setJsonp=function(e){c=e===!0?!0:!1},n.preload=function(e){var n,i=function(){};for(n=0;e.length>n;n++)t(e[n],i)},n.play=function(e,n,i){n=n===!1?!1:!0,i="object"==typeof i?i:{},t(e,function(e,t){(t||n)&&e.sample.set(i).play().bang()})},n.onError=function(){},n.onLoad=function(){},timbre&&timbre.modules&&timbre.modules.Decoder&&timbre.modules.Decoder.mp3_decode&&"browser"===timbre.envtype&&(timbre.soundfont=n)})();